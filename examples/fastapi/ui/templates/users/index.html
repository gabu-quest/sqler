{% extends 'base.html' %}
{% block content %}
  <h2>Users</h2>
  <form class="grid" hx-get="/ui/users/partial/table" hx-target="#user-table" hx-push-url="true">
    <input name="q" type="search" placeholder="Search name…" value="{{ params.q or '' }}" hx-trigger="keyup changed delay:300ms">
    <select name="city" hx-trigger="change">
      <option value="">Any city</option>
      <option value="Otsu" {{ 'selected' if params.city=='Otsu' else '' }}>Otsu</option>
      <option value="Kyoto" {{ 'selected' if params.city=='Kyoto' else '' }}>Kyoto</option>
    </select>
    <input name="min_age" type="number" min="0" placeholder="min age" value="{{ params.min_age or '' }}" hx-trigger="change">
    <select name="sort" hx-trigger="change">
      <option value="age"  {{ 'selected' if params.sort=='age' else '' }}>Sort: Age</option>
      <option value="name" {{ 'selected' if params.sort=='name' else '' }}>Sort: Name</option>
      <option value="id"   {{ 'selected' if params.sort=='id' else '' }}>Sort: ID</option>
    </select>
    <select name="dir" hx-trigger="change">
      <option value="asc"  {{ 'selected' if params.dir=='asc' else '' }}>Asc</option>
      <option value="desc" {{ 'selected' if params.dir=='desc' else '' }}>Desc</option>
    </select>
    <input type="hidden" name="include" value="{{ params.include or '' }}">
  </form>

  <section id="user-table" hx-get="/ui/users/partial/table" hx-trigger="load" hx-vals='{"q":"{{ params.q or '' }}","city":"{{ params.city or '' }}","min_age":"{{ params.min_age or '' }}","sort":"{{ params.sort }}","dir":"{{ params.dir }}","limit":"{{ params.limit }}","offset":"{{ params.offset }}","include":"{{ params.include or '' }}"}'>
  </section>

  <details>
    <summary>New user</summary>
    <form hx-post="/ui/users" hx-target="#user-table" hx-swap="outerHTML">
      <div class="grid">
        <input name="name" placeholder="Name" required>
        <input name="age" type="number" min="0" placeholder="Age" required>
        <select name="address_id">
          <option value="">(no address)</option>
          {% for a in addresses %}
            <option value="{{ a._id }}">#{{ a._id }} — {{ a.city }}, {{ a.country }}</option>
          {% endfor %}
        </select>
        <button type="submit">Create</button>
      </div>
    </form>
  </details>
{% endblock %}
